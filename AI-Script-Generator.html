<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Test & Mistake Logger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        // Firebase App (the core Firebase SDK) is always required and must be listed first
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // Add SDKs for Firebase products that you want to use
        import {
            getAuth,
            onAuthStateChanged,
            GoogleAuthProvider,
            signInWithPopup,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getFirestore,
            collection,
            addDoc,
            onSnapshot,
            query,
            Timestamp,
            doc,
            updateDoc,
            setLogLevel,
            orderBy
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration ---
         const firebaseConfig = {
    apiKey: "AIzaSyAel5UMXHwBaF5-T1ivGkLbXjxx0rEo2NY",
    authDomain: "hona-ai-testing.firebaseapp.com",
    projectId: "hona-ai-testing",
    storageBucket: "hona-ai-testing.firebasestorage.app",
    messagingSenderId: "622197798943",
    appId: "1:622197798943:web:0d1d12603fad4c0addbd2a",
    measurementId: "G-V05JSECQJ9"
  };

        // --- Initialize Firebase ---
        let app, auth, db;
        let currentUser = null;
        let isAuthReady = false;
        let unsubscribeLogs = null;

        // --- UI Elements ---
        const logsContainer = document.getElementById('logsContainer');
        const oldLogsContainer = document.getElementById('oldLogsContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const authStatus = document.getElementById('authStatus');
        const userDisplay = document.getElementById('userDisplay');
        const errorMessage = document.getElementById('errorMessage');
        const signInButton = document.getElementById('signInButton');
        const signOutButton = document.getElementById('signOutButton');
        const viewOldLogsButton = document.getElementById('viewOldLogsButton');

        const generateScriptButton = document.getElementById('generateScriptButton');
        const saveScriptButton = document.getElementById('saveScriptButton');
        const testScriptOutput = document.getElementById('testScriptOutput');
        const scriptCopiedMessage = document.getElementById('scriptCopiedMessage');
        const logCopiedMessage = document.getElementById('logCopiedMessage');
        const scriptSavedMessage = document.getElementById('scriptSavedMessage');

        // Modal Elements
        const evaluationModal = document.getElementById('evaluationModal');
        const evaluationForm = document.getElementById('evaluationForm');
        const closeModalButton = document.getElementById('closeModalButton');
        const cancelModalButton = document.getElementById('cancelModalButton');
        const modalAiResponseInput = document.getElementById('modalAiResponseInput');
        const modalExpectedResponseInput = document.getElementById('modalExpectedResponseInput');
        const modalIsMistakeCheckbox = document.getElementById('modalIsMistakeCheckbox');
        const modalMistakeNotesInput = document.getElementById('modalMistakeNotesInput');

        // --- Helper Functions ---
        function showLoading(isLoading) {
            loadingIndicator?.classList.toggle('hidden', !isLoading);
        }

        function displayMessage(element, message, duration = 3000) {
            if (element) {
                element.textContent = message;
                element.classList.remove('hidden');
                setTimeout(() => {
                    element.classList.add('hidden');
                }, duration);
            }
        }

        function displayError(message) {
            const errorContent = errorMessage?.querySelector('span');
            if (errorContent) {
                errorContent.textContent = message;
                errorMessage.classList.remove('hidden');
                setTimeout(() => {
                    errorMessage.classList.add('hidden');
                    errorContent.textContent = '';
                }, 5000);
            }
            console.error(message);
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = timestamp.toDate();
            return date.toLocaleString();
        }

        function copyToClipboard(text, messageElement, successMessage) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                displayMessage(messageElement, successMessage || 'Copied!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
                displayMessage(messageElement, 'Failed to copy.', 3000);
            }
            document.body.removeChild(textArea);
        }

        // --- Firebase Initialization and Auth ---
        async function initializeFirebaseServices() {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                setLogLevel('debug');

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUser = user;
                        isAuthReady = true;
                        authStatus.textContent = 'Authenticated';
                        userDisplay.innerHTML = `
                            <img src="${user.photoURL}" alt="User Avatar" class="w-8 h-8 rounded-full mr-2">
                            <span>${user.displayName}</span>
                        `;
                        signInButton.classList.add('hidden');
                        signOutButton.classList.remove('hidden');
                        userDisplay.classList.remove('hidden');
                        console.log("User authenticated:", user);
                        await loadLogs();
                    } else {
                        currentUser = null;
                        isAuthReady = false;
                        authStatus.textContent = 'Not Authenticated';
                        userDisplay.classList.add('hidden');
                        signInButton.classList.remove('hidden');
                        signOutButton.classList.add('hidden');
                        logsContainer.innerHTML = '<p class="text-center text-gray-500">Please sign in to view and create logs.</p>';
                        oldLogsContainer.classList.add('hidden');
                        viewOldLogsButton.classList.add('hidden');
                        console.log("User not authenticated.");
                    }
                });

            } catch (error) {
                displayError("Firebase initialization failed.");
            }
        }

        async function signInWithGoogle() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                displayError(`Google sign-in failed: ${error.message}`);
            }
        }

        async function logOut() {
            try {
                await signOut(auth);
            } catch (error) {
                displayError(`Sign-out failed: ${error.message}`);
            }
        }


        // --- Firestore Operations ---
        async function saveScriptForLater() {
            if (!isAuthReady || !currentUser) {
                displayError("Authentication not ready. Cannot save script.");
                return;
            }
            const scriptContent = testScriptOutput.value.trim();
            if (!scriptContent) {
                displayError("Please generate a script first.");
                return;
            }

            showLoading(true);
            try {
                const logsCollectionPath = `ai_test_logs`;
                await addDoc(collection(db, logsCollectionPath), {
                    createdBy: {
                        uid: currentUser.uid,
                        name: currentUser.displayName,
                        photoURL: currentUser.photoURL
                    },
                    script: scriptContent,
                    status: 'pending',
                    createdAt: Timestamp.now()
                });
                displayMessage(scriptSavedMessage, 'Test script saved for later evaluation.');
                testScriptOutput.value = '';
                saveScriptButton.disabled = true;

            } catch (error) {
                displayError(`Failed to save script: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        async function loadLogs() {
            if (!isAuthReady || !currentUser) {
                logsContainer.innerHTML = '<p class="text-center text-gray-500">Authenticate to load logs.</p>';
                return;
            }

            showLoading(true);
            const logsCollectionPath = `ai_test_logs`;
            const q = query(collection(db, logsCollectionPath), orderBy("createdAt", "desc"));

            if (unsubscribeLogs) unsubscribeLogs();

            unsubscribeLogs = onSnapshot(q, (querySnapshot) => {
                logsContainer.innerHTML = '';
                oldLogsContainer.innerHTML = '';
                let pendingLogsExist = false;
                let completedLogsExist = false;

                if (querySnapshot.empty) {
                    logsContainer.innerHTML = '<p class="text-center text-gray-500 py-4">No test logs yet. Generate and save a script to begin.</p>';
                    showLoading(false);
                    return;
                }

                const logs = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                logs.forEach(logData => {
                    const logElement = document.createElement('div');
                    if (logData.status === 'pending') {
                        renderPendingLog(logElement, logData);
                        logsContainer.appendChild(logElement);
                        pendingLogsExist = true;
                    } else {
                        renderCompletedLog(logElement, logData);
                        oldLogsContainer.appendChild(logElement);
                        completedLogsExist = true;
                    }
                });

                if (!pendingLogsExist) {
                    logsContainer.innerHTML = '<p class="text-center text-gray-500 py-4">No pending evaluations.</p>';
                }

                if (completedLogsExist) {
                    viewOldLogsButton.classList.remove('hidden');
                } else {
                    viewOldLogsButton.classList.add('hidden');
                }

                showLoading(false);
            }, (error) => {
                displayError(`Failed to load logs: ${error.message}`);
                showLoading(false);
            });
        }

        function renderPendingLog(logElement, logData) {
            logElement.className = `bg-white p-4 md:p-6 rounded-lg shadow mb-4 border-l-4 border-amber-400`;
            logElement.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div class="text-xs text-gray-500">
                        Saved by ${logData.createdBy?.name || 'Unknown'} on ${formatDate(logData.createdAt)}
                    </div>
                    <span class="px-3 py-1 text-xs font-semibold rounded-full bg-amber-100 text-amber-700">Pending Evaluation</span>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-800 mb-1">Test Script:</h3>
                    <p class="text-sm text-gray-600 bg-gray-50 p-3 rounded whitespace-pre-wrap max-h-48 overflow-y-auto">${logData.script}</p>
                </div>
                <div class="mt-4 flex justify-end">
                    <button data-log-id="${logData.id}" class="evaluate-btn inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700">
                        Evaluate
                    </button>
                </div>
            `;
            logElement.querySelector('.evaluate-btn').addEventListener('click', () => {
                openEvaluationModal(logData.id);
            });
        }

        function renderCompletedLog(logElement, logData) {
            logElement.className = `bg-white p-4 md:p-6 rounded-lg shadow mb-4 border-l-4 ${logData.isMistake ? 'border-red-500' : 'border-green-500'}`;
            const notesHTML = logData.isMistake ? `<div class="mt-3">
                                        <h4 class="font-semibold text-sm text-gray-700">Mistake Notes:</h4>
                                        <p class="text-sm text-gray-600 whitespace-pre-wrap">${logData.mistakeNotes || 'No notes provided.'}</p>
                                     </div>` : '';

            logElement.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                     <div class="text-xs text-gray-500">
                        Evaluated by ${logData.evaluatedBy?.name || 'Unknown'} on ${formatDate(logData.evaluatedAt || logData.createdAt)}
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${logData.isMistake ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                            ${logData.isMistake ? 'Mistake' : 'Correct'}
                        </span>
                        <button data-log-id="${logData.id}" class="copy-log-btn text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium py-1 px-2 rounded-md transition-colors">Copy for Doc</button>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-800 mb-1">AI's Response:</h3>
                    <p class="text-sm text-gray-600 bg-gray-50 p-2 rounded whitespace-pre-wrap">${logData.aiResponse}</p>
                </div>
                <div class="mt-3">
                    <h3 class="font-semibold text-gray-800 mb-1">Expected Response:</h3>
                    <p class="text-sm text-gray-600 bg-gray-50 p-2 rounded whitespace-pre-wrap">${logData.expectedResponse}</p>
                </div>
                ${notesHTML}
                 <details class="mt-2 text-xs">
                     <summary class="cursor-pointer text-slate-500 hover:text-slate-700">Show Original Script</summary>
                     <p class="mt-1 text-gray-600 bg-gray-50 p-2 rounded whitespace-pre-wrap">${logData.script}</p>
                 </details>
            `;
            logElement.querySelector('.copy-log-btn').addEventListener('click', () => {
                const logTextForDoc = `Date: ${formatDate(logData.evaluatedAt || logData.createdAt)}\nStatus: ${logData.isMistake ? 'Mistake' : 'Correct'}\n\nAI's Actual Response:\n${logData.aiResponse}\n\nExpected Correct Response:\n${logData.expectedResponse}\n\n${logData.isMistake && logData.mistakeNotes ? `Mistake Notes:\n${logData.mistakeNotes}` : ''}\n\nOriginal Script:\n${logData.script}\n------------------------------------`;
                copyToClipboard(logTextForDoc.trim(), logCopiedMessage, 'Log entry copied!');
            });
        }

        function openEvaluationModal(logId) {
            evaluationForm.dataset.logId = logId;
            evaluationModal.classList.remove('hidden');
        }

        function closeEvaluationModal() {
            evaluationForm.reset();
            evaluationForm.dataset.logId = '';
            modalMistakeNotesInput.disabled = true;
            evaluationModal.classList.add('hidden');
        }

        async function handleEvaluationSubmit(event) {
            event.preventDefault();
            const logId = event.target.dataset.logId;
            if (!logId) {
                displayError("No log ID found. Cannot save evaluation.");
                return;
            }

            const evaluationData = {
                aiResponse: modalAiResponseInput.value.trim(),
                expectedResponse: modalExpectedResponseInput.value.trim(),
                isMistake: modalIsMistakeCheckbox.checked,
                mistakeNotes: modalMistakeNotesInput.value.trim(),
                status: 'completed',
                evaluatedAt: Timestamp.now(),
                evaluatedBy: {
                    uid: currentUser.uid,
                    name: currentUser.displayName,
                    photoURL: currentUser.photoURL
                }
            };

            if (!evaluationData.aiResponse || !evaluationData.expectedResponse) {
                alert("Please fill in both AI's Response and Expected Response.");
                return;
            }

            try {
                const docRef = doc(db, `ai_test_logs`, logId);
                await updateDoc(docRef, evaluationData);
                closeEvaluationModal();
            } catch (error) {
                displayError(`Failed to save evaluation: ${error.message}`);
            }
        }

        // --- Test Script Generation ---
        function generateTestScript() {
            // This extensive function is collapsed for brevity but is identical to the previous version.
            const firstNames = ["Alex", "Jordan", "Taylor", "Morgan", "Casey", "Riley", "Jamie", "Skyler", "Devon", "Drew", "Pat", "Chris"];
            const lastNames = ["Smith", "Jones", "Williams", "Brown", "Davis", "Miller", "Wilson", "Moore", "Garcia", "Rodriguez", "Lee", "Chen"];
            const targetCounties = ["Onondaga County", "Madison County", "Cayuga County", "Oneida County"];
            const otherNYCounties = ["Erie County", "Monroe County", "Albany County", "Westchester County", "New York County (Manhattan)", "Kings County (Brooklyn)", "Jefferson County", "Oswego County"];
            const outOfStateLocations = [{ city: "Philadelphia", state: "PA" }, { city: "Boston", state: "MA" }, { city: "Cleveland", state: "OH" },{ city: "Newark", state: "NJ" }, { city: "Scranton", state: "PA" }];
            const randomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];
            const randomBool = (probability = 0.5) => Math.random() < probability;
            const fullName = `${randomElement(firstNames)} ${randomElement(lastNames)}`;
            const phoneNumber = `(${Math.floor(Math.random() * 800) + 200}) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`;
            const email = `${fullName.toLowerCase().replace(' ','_').replace(/[^a-z0-9_]/gi, '')}${Math.floor(Math.random()*100)}@example.com`;
            const incidentDate = new Date(Date.now() - Math.floor(Math.random() * 730 * 24 * 60 * 60 * 1000)).toLocaleDateString();
            let residentCounty = "";
            let incidentCountyOrLocation = "";
            let residesInTargetNYCounty = false;
            let issueInTargetNYCounty = false;
            let isIssueInNY = false;
            const scenarioType = Math.random();
            if (scenarioType < 0.60) { residentCounty = randomElement(targetCounties); incidentCountyOrLocation = randomBool(0.8) ? residentCounty : randomElement(targetCounties.concat(otherNYCounties)); residesInTargetNYCounty = true; isIssueInNY = true; issueInTargetNYCounty = targetCounties.includes(incidentCountyOrLocation); }
            else if (scenarioType < 0.85) { residentCounty = randomBool() ? randomElement(otherNYCounties) : `${randomElement(outOfStateLocations).city}, ${randomElement(outOfStateLocations).state}`; incidentCountyOrLocation = randomElement(targetCounties); residesInTargetNYCounty = false; isIssueInNY = true; issueInTargetNYCounty = true; }
            else { residentCounty = randomBool(0.6) ? randomElement(otherNYCounties) : `${randomElement(outOfStateLocations).city}, ${randomElement(outOfStateLocations).state}`; incidentCountyOrLocation = randomBool(0.7) ? randomElement(otherNYCounties) : `${randomElement(outOfStateLocations).city}, ${randomElement(outOfStateLocations).state}`; residesInTargetNYCounty = false; isIssueInNY = otherNYCounties.includes(incidentCountyOrLocation); issueInTargetNYCounty = false; }
            let script = `## AI Test Scenario Script:\n\n**Caller Demographics & Contact:**\n* **Full Name:** ${fullName} (Spell: J-O-H-N D-O-E)\n* **Best Phone Number:** ${phoneNumber} (Confirm: "Yes")\n* **Email Address:** ${email} (Spell: j-o-h-n_d-o-e-at-e-x-a-m-p-l-e-dot-com)\n\n**Location Questions:**\n* **(AI Asks: Reside in Onondaga, Madison, Cayuga, or Oneida?)**\n    * **Your Response:** ${residesInTargetNYCounty ? `"Yes, I live in ${residentCounty}."` : `"No, I live in ${residentCounty}."`}\n`;
            if (!residesInTargetNYCounty) { script += `* **(AI Asks: Issue arise or pending matter in those counties?)**\n    * **Your Response:** ${issueInTargetNYCounty ? `"Yes, the issue happened in ${incidentCountyOrLocation}."` : `"No, the issue is in ${incidentCountyOrLocation}."`}\n`; }
            script += `\n**Incident Details:**\n* **(AI Asks: When did incident occur?)**\n    * **Your Response:** "Around ${incidentDate}."\n\n**Matter Type Triage:**\n* **(AI Asks: Criminal, family, or civil?)**\n`;
            const matterTypeRand = Math.random(); let matterType = ""; let pricingConfirmationResponse = randomBool(0.7) ? `"Yes, I'd like to move forward."` : `"No, that's more than I expected."`;
            if (matterTypeRand < 0.33) { matterType = "Criminal"; script += `    * **Your Response:** "Criminal."\n* **(AI Asks: Violent felony/sex crime?)** -> ${randomBool(0.2) ? `"Yes."` : `"No."`}\n* **(AI Asks: Traffic matter?)** -> ${randomBool(0.4) ? `"Yes, speeding ticket."` : `"No, it's about a DWI."`}\n* **(AI Presents Pricing?)** -> **Your Response:** ${pricingConfirmationResponse}\n`; }
            else if (matterTypeRand < 0.66) { matterType = "Family"; script += `    * **Your Response:** "Family."\n* **(AI Asks: Divorce/guardianship?)** -> ${randomBool(0.6) ? `"Yes, a divorce."` : `"No, it's about child support."`}\n* **(AI Presents Pricing?)** -> **Your Response:** ${pricingConfirmationResponse}\n`; }
            else { matterType = "Civil"; script += `    * **Your Response:** "Civil."\n`; const civilTypeRand = Math.random();
                if (civilTypeRand < 0.33) { script += `* **(AI Asks: Regarding an injury?)** -> "Yes."\n* **(AI Asks: What is injury?)** -> "${randomElement(["Whiplash", "Broken arm"])}"\n* **(AI Asks: Where occur?)** -> "${randomElement(["A store", "A restaurant"])} in ${incidentCountyOrLocation}."\n`; }
                else if (civilTypeRand < 0.66) { const physicallyInjured = randomBool(0.6); script += `* **(AI Asks: Civil rights matter?)** -> "Yes, excessive force."\n* **(AI Asks: Which gov entity?)** -> "${randomElement(["Syracuse Police", "Onondaga Sheriff"])}."\n* **(AI Asks: Physically injured?)** -> ${physicallyInjured ? `"Yes."` : `"No."`}\n`; if (!physicallyInjured) { script += `* **(AI Asks: Why sue?)** -> "Wrongful arrest."\n`; } }
                else { script += `* **(AI Asks: MCA/business dispute?)** -> "Yes."\n`; if (randomBool(0.6)) { script += `* **(AI Follow-up?)** -> "It's a Merchant Cash Advance."\n* **(AI Asks Lender?)** -> "${randomElement(["Rapid Finance", "QuickFund"])}"\n* **(AI Asks Sued?)** -> ${randomBool(0.4) ? `"Yes."` : `"No."`}\n* **(AI Asks Amount?)** -> "$${Math.floor(Math.random() * 180 + 20)}000"\n`; } else { script += `* **(AI Follow-up?)** -> "A business dispute."\n* **(AI Asks About it?)** -> "A supplier didn't deliver goods per our contract in ${incidentCountyOrLocation}."\n`; } } }
            script += `\n--- End of Script ---\nFollow the script, then log results later.`;
            testScriptOutput.value = script.trim();
            saveScriptButton.disabled = false;
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebaseServices();
            generateScriptButton.addEventListener('click', generateTestScript);
            saveScriptButton.addEventListener('click', saveScriptForLater);
            evaluationForm.addEventListener('submit', handleEvaluationSubmit);
            closeModalButton.addEventListener('click', closeEvaluationModal);
            cancelModalButton.addEventListener('click', closeEvaluationModal);
            signInButton.addEventListener('click', signInWithGoogle);
            signOutButton.addEventListener('click', logOut);
            viewOldLogsButton.addEventListener('click', () => {
                oldLogsContainer.classList.toggle('hidden');
                viewOldLogsButton.textContent = oldLogsContainer.classList.contains('hidden') ? 'View Old Logs' : 'Hide Old Logs';
            });
            modalIsMistakeCheckbox.addEventListener('change', () => {
                modalMistakeNotesInput.disabled = !modalIsMistakeCheckbox.checked;
                if (!modalIsMistakeCheckbox.checked) {
                    modalMistakeNotesInput.value = '';
                }
            });
        });

    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .whitespace-pre-wrap { white-space: pre-wrap; word-break: break-word; }
        textarea { scrollbar-width: thin; scrollbar-color: #cbd5e1 #f1f1f1; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .message-popup { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col items-center justify-start py-6 md:py-12 px-4">

    <div id="evaluationModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Evaluate Test Case</h3>
                    <button id="closeModalButton" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">&times;</button>
                </div>
                <form id="evaluationForm" class="space-y-4">
                    <div>
                        <label for="modalAiResponseInput" class="block text-sm font-medium text-slate-700">AI's Actual Response:</label>
                        <textarea id="modalAiResponseInput" rows="4" required class="mt-1 w-full p-2 border border-slate-300 rounded-md shadow-sm"></textarea>
                    </div>
                    <div>
                        <label for="modalExpectedResponseInput" class="block text-sm font-medium text-slate-700">Expected Correct Response:</label>
                        <textarea id="modalExpectedResponseInput" rows="4" required class="mt-1 w-full p-2 border border-slate-300 rounded-md shadow-sm"></textarea>
                    </div>
                    <div class="flex items-center space-x-3">
                        <input id="modalIsMistakeCheckbox" type="checkbox" class="h-5 w-5 text-indigo-600 border-slate-300 rounded">
                        <label for="modalIsMistakeCheckbox" class="text-sm font-medium text-slate-700">Was this a mistake by the AI?</label>
                    </div>
                    <div>
                        <label for="modalMistakeNotesInput" class="block text-sm font-medium text-slate-700">Notes/Details about mistake:</label>
                        <textarea id="modalMistakeNotesInput" rows="3" disabled class="mt-1 w-full p-2 border border-slate-300 rounded-md shadow-sm disabled:bg-slate-50"></textarea>
                    </div>
                    <div class="items-center px-4 py-3 bg-gray-50 text-right -mx-5 -mb-5 rounded-b-md mt-6">
                        <button id="cancelModalButton" type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md mr-2 hover:bg-gray-300">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save Evaluation</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <div class="w-full max-w-3xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">AI Test & Mistake Logger</h1>
            <p class="text-slate-600 mt-2">A tool for attorneys to generate test scripts and log AI intake performance.</p>
            <div class="mt-4 bg-indigo-100 border border-indigo-200 text-indigo-800 px-4 py-2 rounded-lg inline-block text-sm sm:text-base">
                <span class="font-semibold">AI Test Phone Number:</span>
                <a href="tel:+18332720905" class="font-bold tracking-wider">+1 (833) 272-0905</a>
            </div>
            <div class="mt-3 text-xs text-slate-500 flex items-center justify-center">
                <div id="userDisplay" class="hidden flex items-center"></div>
                <button id="signInButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                  Sign in with Google
                </button>
                <button id="signOutButton" class="hidden bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded ml-4">
                  Sign Out
                </button>
                <span id="authStatus" class="ml-4">Initializing...</span>
            </div>
        </header>

        <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6 text-sm"><strong class="font-bold">Error: </strong><span></span></div>
        <div id="scriptSavedMessage" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-6 text-sm"></div>

        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-8">
            <h2 class="text-xl font-semibold text-slate-700 mb-4">1. Generate & Save a Test Script</h2>
            <p class="text-sm text-slate-600 mb-4">Create a randomized script, save it to the log below, then call the AI test number.</p>
            <div class="flex flex-col sm:flex-row gap-2">
                <button id="generateScriptButton" class="flex-1 inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-sky-600 hover:bg-sky-700">Generate New Script</button>
                <button id="saveScriptButton" disabled class="flex-1 inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed">Save Test for Later</button>
            </div>
            <textarea id="testScriptOutput" readonly rows="8" class="mt-4 w-full p-3 border border-slate-300 rounded-md shadow-sm bg-slate-50 text-sm whitespace-pre-wrap" placeholder="Your generated test script will appear here..."></textarea>
            <span id="scriptCopiedMessage" class="hidden ml-3 text-sm text-green-600"></span>
        </div>

        <div>
            <h2 class="text-xl font-semibold text-slate-700 mb-6">2. Evaluate Test Calls</h2>
             <p class="text-sm text-slate-600 mb-4 -mt-4">Find your saved test case below and click "Evaluate" to add the AI's results.</p>
            <div id="loadingIndicator" class="hidden text-center py-4">
                <p class="text-slate-500">Loading logs...</p>
                <div class="mt-2 inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div>
            </div>
            <div id="logsContainer" class="space-y-4">
                 <p class="text-center text-gray-500 py-4">Initializing and authenticating... Please wait.</p>
            </div>
             <div class="text-center mt-6">
                <button id="viewOldLogsButton" class="hidden bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded">
                  View Old Logs
                </button>
            </div>
            <div id="oldLogsContainer" class="hidden space-y-4 mt-6">
                </div>
             <span id="logCopiedMessage" class="hidden message-popup bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg"></span>
        </div>
    </div>

    <footer class="mt-12 text-center text-sm text-slate-500">
        <p>&copy; <span id="currentYear"></span> AI Test Logger. For RWJ Esq PLLC.</p>
        <script>document.getElementById('currentYear').textContent = new Date().getFullYear();</script>
    </footer>

</body>
</html>
